<!DOCTYPE html>

<html>
<head>
<meta charset="UTF-8">
<title>Insert title here</title>
<link href="css/main.css" rel="stylesheet" media="screen">
<link href="css/goods.css" rel="stylesheet" media="screen">
<link href="css/font-awesome.css" rel="stylesheet" media="screen">
<link href="css/bootstrap.css" rel="stylesheet" media="screen">
<script type="text/javascript" src="js/jquery-3.3.1.min.js"></script>
<script type="text/javascript" src="js/bootstrap.js"></script>
<style type="text/css">
.all_goods{
	font-size: 18px;
	color: #ff0101;
	font-weight:600;
	padding-bottom:15px;
}
.goods_title{
	padding-left:10px;
	float:left;
	padding-top:10px;
	padding-bottom:10px;
}

.cart_intro{
	width:100%; 
	overflow:hidden;
	border-top:1px solid #e1e1e1;
}
.cart_intro ul{
	margin:0px !important;
	padding-top:10px !important;
	padding-bottom:10px !important;
	overflow:hidden;
}
.cart_intro ul li{
	text-align: left;
	float:left;
	list-style:none;
	padding-left:10px;
}
a{
	cursor:pointer;
}
.check_cart{
	cursor:pointer;
}
.total{
	margin-top:10px;
	background-color:#e1e1e1;
	width:100%;
	height:50px;
}
.account{
	float:right;
	background-color:#f40;
	cursor:pointer;
	width:100px;
	height:50px;
	color:#fff;
	line-height: 50px;
    text-align: center;
}
.total_price{
	float:right;
	width:200px;
	height:50px;
	color:#f40;
	line-height: 50px;
    text-align: center;
}
.total_price span{
	font-size:22px;
	color:#f40;
}
.del{
	float:left;
	width:120px;
	line-height: 50px;
    text-align: center;
}
.del a{
	margin-left:20px;
}
</style>
<script type="text/javascript">


</script>

</head>
<body>
<div class="header">
	<div class="header-bg"></div>
	<div class="header-wrap">
		<div class="header-main">
			<div class="header-logo">
				<a href="http://china.CBA.com/" class="link-china"><img src="images/cba-logo_01.png" style="height: 80px;"></a>
			</div>
		</div>

		<div class="nav index">
			<div class="nav-wrap">
				<ul>
					<li class="nav-tab nav-index"><a href="main.html" class="no-arrow">首页</a></li>
					<li id = "team" class="nav-tab nav-teams">
						<a href="main.html">球队 <span class="glyphicon glyphicon-chevron-down"></span></a>
						<div class="nav-team">
							<ul style="padding-left: 0px;">
								<li class="team-list">
									<a href="club.html?id=1001" target="_blank" class="label-hornets"><img src="../CBA/images/clubs/1001.png" class="img-logo">北京首钢</a>
									<a href="club.html?id=1002" target="_blank" class="label-cavaliers"><img src="../CBA/images/clubs/1002.jpg"  class="img-logo">辽宁本钢</a>
									<a href="club.html?id=1003" target="_blank" class="label-raptors"><img src="../CBA/images/clubs/1003.png"  class="img-logo">广东东莞银行</a>
									<a href="club.html?id=1004" target="_blank" class="label-raptors"><img src="../CBA/images/clubs/1004.jpg"  class="img-logo">新疆喀什古城</a>
									<a href="club.html?id=1005" target="_blank" class="label-raptors"><img src="../CBA/images/clubs/1005.jpg"  class="img-logo">深圳马可波罗</a>
								</li>
								<li class="team-list gray" style="background-color:#f5f5f5;">
									<a href="club.html?id=1006" target="_blank" class="label-hawks"><img src="../CBA/images/clubs/1006.jpg" class="img-logo">浙江广厦控股</a>
									<a href="club.html?id=1007" target="_blank" class="label-bulls"><img src="../CBA/images/clubs/1007.jpg" class="img-logo">天津滨海云商</a>
									<a href="club.html?id=1008" target="_blank" class="label-knicks"><img src="../CBA/images/clubs/1008.jpg" class="img-logo">上海哔哩哔哩</a>
									<a href="club.html?id=1009" target="_blank" class="label-knicks"><img src="../CBA/images/clubs/1009.jpg" class="img-logo">山东高速</a>
									<a href="club.html?id=1010" target="_blank" class="label-knicks"><img src="../CBA/images/clubs/1010.png" class="img-logo">福建浔兴SBS</a>
								</li>
								<li class="team-list">
									<a href="club.html?id=1011" target="_blank" class="label-wizards"><img src="../CBA/images/clubs/1011.png" class="img-logo">南京同曦</a>
									<a href="club.html?id=1012" target="_blank" class="label-pistons"><img src="../CBA/images/clubs/1012.jpg" class="img-logo">四川品胜</a>
									<a href="club.html?id=1013" target="_blank" class="label-celtics"><img src="../CBA/images/clubs/1013.jpg" class="img-logo">浙江稠州银行</a>
									<a href="club.html?id=1014" target="_blank" class="label-celtics"><img src="../CBA/images/clubs/1014.jpg" class="img-logo">九台农商银行</a>
									<a href="club.html?id=1015" target="_blank" class="label-celtics"><img src="../CBA/images/clubs/1015.png" class="img-logo">广州证券</a>
								</li>
								<li class="team-list gray" style="background-color:#f5f5f5;">
									<a href="club.html?id=1016" target="_blank" class="label-magic"><img src="../CBA/images/clubs/1016.png" class="img-logo">山西汾酒股份</a>
									<a href="club.html?id=1017" target="_blank" class="label-pacers"><img src="../CBA/images/clubs/1017.png" class="img-logo">八一双鹿电池</a>
									<a href="club.html?id=1018" target="_blank" class="label-nets"><img src="../CBA/images/clubs/1018.jpg" class="img-logo">青岛国信双星</a>
									<a href="club.html?id=1019" target="_blank" class="label-nets"><img src="../CBA/images/clubs/1019.jpg" class="img-logo">江苏肯帝亚</a>
									<a href="club.html?id=1020" target="_blank" class="label-nets"><img src="../CBA/images/clubs/1020.jpg" class="img-logo">北京农商银行</a>
								</li>
							</ul>
						</div>
					</li>
					<li class="nav-tab nav-players"><a href="player.html">球员</a></li>
					<li class="nav-tab nav-schedule"><a href="schedule.html">赛程</a></li>
					<li class="nav-tab nav-schedule"><a href="main.html">商城</a></li>
				</ul>
			</div>
			<div class="nav-side">
				<div class="side-cart" onclick="showCart()"><i class="fa fa-shopping-cart" aria-hidden="true"></i></div>
		        <div class="side-user" id="user-face">
		            <div class="user-head"><img src="images/user.png" id="user-face"> <div class="username"></div></div>
		            <ul class="user-menu">
		                <li class="user-info" align="center">您好~请您登录</li>
		                <li class="user-login"><button type="button" class="btn btn-primary" style="width:100%;padding: 0px;" onclick="window.location.href='userLogin.html'">登录</button></li>
		            </ul>

		        </div>
		    </div>

		</div>
	</div>
</div>

<div class="container">
	<div class="section">
		<div class="row">
			<div style="font-size: 25px;margin-left: 10%;padding-bottom: 30px;"><img alt="" style="width: 50px" src="images/cart.jpg">购物车</div>
			<div style="margin-left:10%;margin-right:10%">
				<div class="all_goods" >
				<span>全部商品</span>
				</div>
				<div class="all_cart">
					<div style="overflow: hidden;background-color: #f9f9f9;">
						<div style="width: 10%; " class="goods_title">
							<i class="fa fa-square-o" aria-hidden="true" style="cursor:pointer;margin-right: 5px;" onclick="select_all(this)"></i>全选
						</div>
						<div style="width: 30%;" class="goods_title">
							商品信息					
						</div>
						<div style="width: 10%;" class="goods_title">
							单价					
						</div>
						<div style="width: 30%;padding-left:5%;" class="goods_title">
							数量				
						</div>
						<div style="width: 10%;" class="goods_title">
							金额				
						</div>
						<div style="width: 10%;"  class="goods_title">
							操作				
						</div>
					</div>
					<div id="main_cart" style="border:1px solid #e1e1e1;width:100%">
<!-- 						<div class="cart_intro">
							<ul>
								<li style="width: 5%;"><input type="checkbox"><li>
								<li style="width: 35%;overflow:hidden;white-space: nowrap;text-overflow: ellipsis;"><img style=" width:20%" alt="" src="images/goods/10014.jpg">CBA球迷纪念品周边公司企业社区篮球队球员礼品定制LOGO订做印字 CBA款</li>
								<li style="width: 10%;color:red">160元</li>
								<li style="width: 30%;">						
									<div style="width: 80%;padding-top:2%;">
										<button id="dec" class="btn btn-primary" style="float:left" onclick="numDec(this)" disabled="disabled"><i class="fa fa-minus" aria-hidden="true"></i></button> 
											 <input type="text" class="form-control" onchange="change()" style="width:25%;float:left;    margin-left: 2px;margin-right: 2px;" id="quantity" value="1"/>
										<button id="add" class="btn btn-primary" style="float:left" onclick="numAdd(this)"><i class="fa fa-plus" aria-hidden="true"></i></button>
									</div>
								</li>
								<li style="width:10%">160元</li>
								<li style="width: 10%;"><a>删除</a></li>
							</ul>
						</div>
						<div class="cart_intro">
							<ul>
								<li style="width: 5%;"><input type="checkbox"><li>
								<li style="width: 35%;overflow:hidden;white-space: nowrap;text-overflow: ellipsis;"><img style=" width:20%" alt="" src="images/goods/10014.jpg">CBA球迷纪念品周边公司企业社区篮球队球员礼品定制LOGO订做印字 CBA款</li>
								<li style="width: 10%;color:red">160元</li>
								<li style="width: 30%;">						
									<div style="width: 80%;padding-top:2%;">
										<button id="dec" class="btn btn-primary" style="float:left" onclick="numDec(this)" disabled="disabled"><i class="fa fa-minus" aria-hidden="true"></i></button> 
											 <input type="text" class="form-control" onchange="change()" style="width:25%;float:left;    margin-left: 2px;margin-right: 2px;" id="quantity" value="1"/>
										<button id="add" class="btn btn-primary" style="float:left" onclick="numAdd(this)"><i class="fa fa-plus" aria-hidden="true"></i></button>
									</div>
								</li>
								<li style="width:10%">160元</li>
								<li style="width: 10%;"><a>删除</a></li>
							</ul>
						</div> -->
					</div>

				</div>
			</div>
		</div>
	</div>
</div>
<div class="footer">


</div>
<script type="text/javascript">

	$("#team").hover(
			function(){$(this).find("div").show();},function(){$(this).find("div").hide();}
		);
	$("#user-face").hover(
			function(){$(this).find("ul").show();},function(){$(this).find("ul").hide();}
		);
	 window.onload=function(){
 		 	$.ajax({
				type:'post',
				url:'q_Cart.action',
				dataType:'json',
				success:function(data){
						var c = eval(data);  
						showGoodsCart(c);
					}
			});  
		 	$.ajax({
				type:'post',
				url:'userName.action',
				dataType:'json',
				success:function(data){
						var user = eval(data);  
						if(user!=null)
							showUser(user);
					}
			});
	}
	
	function ready()  
	{  
	    var mymessage=confirm("确定删除吗？");  
	    if(mymessage==true)  
	    {  
	        return true;
	    }  
	    else if(mymessage==false)  
	    {  
	        return false; 
	    }  
	}
	function showUser(user){
		$(".username").html(user.username);
		$(".user-menu").empty();
		var html="<li class='user-info' align='center'><a href='info.html'>个人信息</a></li><li class='user-info' align='center'><a href='order.html'>订单信息</a></li><li class='user-info' align='center'><a href='userLogin.html'>退出</a></li>"
		$(".user-menu").append(html);
	}
	function showGoodsCart(c){
		console.log(c);
		if(c.length>0){
			
			var s = "<div class='total'><div class='account' onclick='account_total()'>结算</div><div class='total_price'>合计：<i class='fa fa-jpy' aria-hidden='true'></i><span  id='total_price'>0</span></div><div class='del'><i class='fa fa-square-o' aria-hidden='true' style='cursor:pointer;margin-right: 5px;' onclick='select_all(this)' ></i>全选<a onclick='del_all()' href='javascript:void(0);' >删除</a></div></div>";
			$(".all_cart").append(s);
		}
		for(var i=0; i<c.length; i++){
			var str = "<div class='cart_intro'><ul><li style='width: 5%;'><input cartId='"+c[i].cartId+"' goodsId='"+c[i].id+"' class='check_cart' onclick='total_price()' type='checkbox'></li><li style='width: 35%;overflow:hidden;white-space: nowrap;text-overflow: ellipsis;'><a href='goods.html?id="+c[i].id+"' style='color: #14171a;text-decoration: none;'><img style=' width:20%'  src='../CBA/"
						+c[i].img+"'><span>"+c[i].name+"</span></a></li><li style='width: 10%;color:red'><span>"+c[i].price+"</span>元</li><li style='width: 30%;color: #c3b3b3;'><div style='width: 80%;padding-top:2%;'><button class='btn btn-primary' style='float:left' onclick='numDec(this)' ";
			if(parseInt(c[i].buyNum)==1)
				str +="disabled='disabled'";
				str +="><i class='fa fa-minus' aria-hidden='true'></i></button> <input type='text' class='form-control' onchange='change(this)' style='width:25%;float:left;    margin-left: 2px;margin-right: 2px;padding:6px 6px;' id='quantity' value='"
						+c[i].buyNum+"'/><button class='btn btn-primary' style='float:left' onclick='numAdd(this)'";
				if(c[i].buyNum>=c[i].num)
					str += "disabled='disabled'";
				str += "><i class='fa fa-plus' aria-hidden='true'></i></button></div>库存<span>"
						+c[i].num+"</li><li style='width:10%;color:red'><span>"
						+parseFloat(c[i].price)*parseInt(c[i].buyNum)+"</span>元</li><li style='width: 10%;'><a href='javascript:void(0);' onclick='del(this)'>删除</a></li></ul></div>";
			$("#main_cart").append(str);
		}
		var html="<div id='copyright-wrap'><div id='copyright-content'><div class='copyright-content'><p><em>&copy;</em>2018年著作权 CBA 中国所有权。</p><p><a target='_blank' href='http://china.CBA.com/'>CBA.com/China</a>上除去<a target='_blank' href='http://CBAchina.qq.com/a/20150623/047888.htm'>使用条款</a>中所特别提及的部分之外，其它任何内容都不得以任何形式被复制、再传播，或篡改。</p><p>进入<a target='_blank' href='http://china.CBA.com/'>CBA.com/China</a>后，即表示阁下同意遵守<a target='_blank' href='http://china.CBA.com/'>CBA.com/China</a>的<a target='_blank' href='http://CBAchina.qq.com/a/20150623/047968.htm'>隐私政策</a>和<a target='_blank' href='http://CBAchina.qq.com/a/20150623/047888.htm'>使用条款</a>。</p><p>有任何的建议和意见，都欢迎联络我们：<a href='mailto:CBAChinaInfo@CBA.com'>CBAChinaInfo@CBA.com</a></p><p>有关CBA商品授权合作事宜，敬请联系:<a href='mailto:GMGChinaBusinessInquiry@CBA.com'>GMGChinaBusinessInquiry@CBA.com</a></p></div></div></div>"
		$(".footer").append(html);
		total_price()
	}

	/*商品数量+1*/
	function numAdd(obj){
		var goods_num = parseInt($(obj).parent().parent().find("span").html());
		var num_add = parseInt($(obj).prev().val())+1;
		$(obj).prev().val(num_add);
		if (num_add>1) {
			$(obj).prev().prev().removeAttr("disabled");
		}
		if(num_add==goods_num){
			$(obj).attr("disabled","disabled");
		}	
		var cost = parseFloat($(obj).parent().parent().prev().find("span").html())*num_add;
		$(obj).parent().parent().next().find("span").html(cost);
		$(obj).prev().val(num_add); 
		total_price();

		var num = $(obj).prev().val();
		var cartId = $(obj).parent().parent().parent().find("li").eq(0).find("input").attr("cartId");
 		$.ajax({
			type:'post',
			url:'updateGoodsCart.action',
			
			data:{cartId:cartId,num:num},
			dataType:'json',
			success:function(data){

				}
		}); 
	}
	/*商品数量-1*/
	function numDec(obj){
		
		var num_dec = parseInt($(obj).next().val())-1;
		if(num_dec<2){
			$(obj).attr("disabled","disabled");
		}else{
			$(obj).next().next().removeAttr("disabled");
		}
		var cost = parseFloat($(obj).parent().parent().prev().find("span").html())*num_dec;
		$(obj).parent().parent().next().find("span").html(cost);
		$(obj).next().val(num_dec);
		total_price();

		var num = $(obj).next().val();
		var cartId = $(obj).parent().parent().parent().find("li").eq(0).find("input").attr("cartId");
 		$.ajax({
			type:'post',
			url:'updateGoodsCart.action',
			
			data:{cartId:cartId,num:num},
			dataType:'json',
			success:function(data){

				}
		}); 
	}
	function change(obj){
		var goods_num = parseInt($(obj).parent().parent().find("span").html());
		if($(obj).val()>=goods_num){
			$(obj).next().attr("disabled","disabled");
			$(obj).prev().removeAttr("disabled");
			var cost = parseFloat($(obj).parent().parent().prev().find("span").html())*goods_num;
			$(obj).parent().parent().next().find("span").html(cost);
			$(obj).val(goods_num);
		}else if($(obj).val()>1){
			$(obj).prev().removeAttr("disabled");
			$(obj).next().removeAttr("disabled");
			var cost = parseFloat($(obj).parent().parent().prev().find("span").html())*parseInt($(obj).val());
			$(obj).parent().parent().next().find("span").html(cost);
		}else{
			$(obj).val(1);
			$(obj).prev().attr("disabled","disabled");
			$(obj).parent().parent().next().find("span").html($(obj).parent().parent().prev().find("span").html());
		}
		total_price();

		var num = $(obj).val();
		var cartId = $(obj).parent().parent().parent().find("li").eq(0).find("input").attr("cartId");
 		$.ajax({
			type:'post',
			url:'updateGoodsCart.action',
			
			data:{cartId:cartId,num:num},
			dataType:'json',
			success:function(data){

				}
		}); 
	}
	function select_all(obj){
		if($(obj).attr("class")=="fa fa-square-o"){
			$(".fa-square-o").attr("class","fa fa-check-square-o");
			$(".check_cart").prop("checked", true);
		}else{
			$(".fa-check-square-o").attr("class","fa fa-square-o");
			$(".check_cart").prop("checked", false);
		}
		total_price();
	}
	function total_price(){
		var total = 0;
		$("input[type=checkbox]:checked").each(function(){
			total += parseFloat($(this).parent().next().next().next().next().find("span").html());
		})
		$("#total_price").html(total);
	}
	function del_all(){
		var param = new Array();
		$("input[type=checkbox]:checked").each(function(){
			var params = {};
			params.cartId = $(this).attr("cartId");
			param.push(params);
		});
		$.ajax({
			type:'post',
			url:'delCartList.action',

 			contentType:"application/json",
			data:JSON.stringify(param),
			dataType:'json',
			success:function(data){
					if(data==1){
						alert("删除成功！");
						location.reload() ;
					}
				}
		});
	}
	function del(obj){
		var cartId = $(obj).parent().parent().children(":first").find("input").attr("cartId");
		$.ajax({
			type:'post',
			url:'delCart.action',
			
			data:{cartId:cartId},
			dataType:'json',
			success:function(data){
					if(data==1){
						alert("删除成功！");
						location.reload() ;
					}
				}
		});
	}
	function account_total(){
		var total = parseFloat($(".total_price").find("span").html());
		if(total>0){
			var param = new Array();
			$("input[type=checkbox]:checked").each(function(){
				var params = {};
				params.cartId = $(this).attr("cartId");
				params.goodsId = $(this).attr("goodsId");
			 	params.img = $(this).parent().next().find("img").attr("src");
			 	params.name = $(this).parent().next().find("span").html();
			 	params.price = $(this).parent().next().next().find("span").html();
			 	params.buyNum = $(this).parent().next().next().next().find("div").find("input").val();
			 	params.priceNum = $(this).parent().next().next().next().next().find("span").html();
				param.push(params);
			});
			sessionStorage.setItem("param",JSON.stringify(param));
			sessionStorage.setItem("total",total);
			window.location.href="confirmOrder.html";
		}else{
			alert("请选择商品！");
		}
	}
	function showCart(){
	 	$.ajax({
			type:'post',
			url:'userNameExist.action',
			dataType:'json',
			success:function(data){
					console.log(1); 
					if(data==1)
						window.location.href="goodsCart.html";
					else
						window.location.href="userLogin.html";
				}
		});
	}
</script>
</body>
</html>